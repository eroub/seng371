{"version":3,"file":"productModel.js","sourceRoot":"","sources":["../../../src/models/productModel.ts"],"names":[],"mappings":"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","sourcesContent":["import DbClient = require(\"../DbClient\");\r\nconst datab = DbClient.connect();\r\n\r\nexport class ProductModel {\r\n\r\n    constructor() {}\r\n\r\n    /**\r\n     * Gets shoe info for a set of shoe keys (deprecated).\r\n     *\r\n     * @class ProductModel\r\n     * @method getAllShoes\r\n     * @param shoeKeysVal {Any} An array of shoe key JSON objects.\r\n     * @return An array of shoe JSON objects.\r\n     */\r\n    public getAllShoes(shoeKeysVal: any) {\r\n\r\n        const keyArr: any[] = [];\r\n\r\n        // get the keys from the input, keys_arr should be equal to [1,3,5] from the example above\r\n\r\n        let prop;\r\n        for (prop of shoeKeysVal) {\r\n            keyArr.push(JSON.parse(JSON.stringify(prop)).shoe_id);\r\n        }\r\n\r\n        // an array of objects holding indvidual json objects for each of the shoes the user has\r\n        const jsonShoeArr: any[] = [];\r\n\r\n        const shoes = DbClient.connect()\r\n            .then((db) => {\r\n                // will return all the shoes in db\r\n                return db!.collection(\"shoes\").find().toArray();\r\n            })\r\n            .then((sneakers: any) => {\r\n                // loop over all the shoes in db and push into jsonShoeArr only those that are\r\n                // owned by user\r\n                let shoe;\r\n                let id;\r\n                for (shoe of sneakers ) {\r\n                    for (id of keyArr) {\r\n                        // if current shoe is also a shoe owned by user, id is type string so we typecast to number\r\n                        if (shoe.shoe_id === Number(id)) {\r\n                            jsonShoeArr.push(shoe);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                return jsonShoeArr;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Getting all shoes has failed\");\r\n            });\r\n\r\n        return shoes;\r\n    }\r\n\r\n    /**\r\n     * Gets shoe info for a specific shoe.\r\n     *\r\n     * @class ProductModel\r\n     * @method getOneShoe\r\n     * @param shoeID {Any} The shoe_id of the shoe to get info for.\r\n     * @return A single shoe JSON object (if the shoe exists).\r\n     */\r\n    public getOneShoe(shoeID: any) {\r\n\r\n        // an array of objects holding indvidual json objects for each of the shoes the user has\r\n        const jsonShoeArr: any[] = [];\r\n\r\n        const shoes = DbClient.connect()\r\n            .then((db) => {\r\n\r\n                // will return all the shoes in db\r\n                return db!.collection(\"shoes\").find().toArray();\r\n\r\n            })\r\n\r\n            .then((sneakers: any) => {\r\n\r\n                // loop over all the shoes in db and push into jsonShoeArr only the shoe that has id\r\n                // shoeID\r\n                let shoe;\r\n                for ( shoe of sneakers ) {\r\n                    // if current shoe is also a shoe whose id is shoeID, shoeID is type string so we typecast to number\r\n                    if (shoe.shoe_id === Number(shoeID)) {\r\n                        jsonShoeArr.push(shoe);\r\n                        break;\r\n                    }\r\n                }\r\n                return jsonShoeArr[0];\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Getting a shoe has failed\");\r\n            });\r\n\r\n        return shoes;\r\n    }\r\n\r\n    /*\r\n            Return all the shoes for the view where we need to see all shoes available in db\r\n     */\r\n\r\n    /**\r\n     * Updates the current price of all shoes.\r\n     *\r\n     * @class ProductModel\r\n     * @method updateShoes\r\n     * @param priceChange {Any} The new current price.\r\n     * @return true if the prices were updated successfully, otherwise false.\r\n     */\r\n    public updateShoes(priceChange: any) {\r\n        const shoeUpdate = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").updateMany({}, { $inc: { current_price: priceChange }});\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Failed to update shoes\");\r\n                return false;\r\n            });\r\n        return shoeUpdate;\r\n    }\r\n\r\n    /**\r\n     * Gets all the shoes in the database.\r\n     *\r\n     * @class ProductModel\r\n     * @method getAllDB\r\n     * @return An array of shoe JSON objects.\r\n     */\r\n    public getAllDB() {\r\n        const shoes = datab\r\n            .then((db) => {\r\n                return db!.collection(\"shoes\").find().toArray();\r\n            })\r\n            .then((sneakers: any) => {\r\n                return sneakers;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Returning all shoes in the database has failed\");\r\n            });\r\n\r\n        return shoes;\r\n    }\r\n\r\n    /**\r\n     * Adds a shoe to the database.\r\n     *\r\n     * @class ProductModel\r\n     * @method add_shoe\r\n     * @param model {Any} the model of the new shoe.\r\n     * @param shoeID {Number} the shoe_id of the new shoe.\r\n     * @param size {Any} the size of the new shoe\r\n     * @param cp {Any} the current_price of the new shoe.\r\n     * @param rp {Any} the retail_price of the new shoe.\r\n     * @param brand {Any} the brand of the new shoe.\r\n     * @param colorway {Any} the colorway of the new shoe.\r\n     * @return true if the shoe was added successfully, otherwise false.\r\n     */\r\n    public add_shoe(model: any, shoeId: number, size: any, cp: any, rp: any, brand: any, colorway: any) {\r\n        const addShoes = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").insertOne({ brand, colorway, current_price: cp,\r\n                    model, retail_price: rp, shoe_id: shoeId, size});\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Adding a shoe to the database has failed\");\r\n                return false;\r\n            });\r\n        return addShoes;\r\n    }\r\n\r\n    /**\r\n     * Edits a shoe in the database.\r\n     *\r\n     * @class ProductModel\r\n     * @method edit_shoe\r\n     * @param model {Any} the new model of the shoe.\r\n     * @param shoeId {Number} the shoe_id of the shoe.\r\n     * @param size {Any} the new size of the shoe\r\n     * @param cp {Any} the new current_price of the shoe.\r\n     * @param rp {Any} the new retail_price of the shoe.\r\n     * @param brand {Any} the new brand of the shoe.\r\n     * @param colorway {Any} the new colorway of the shoe.\r\n     * @return true if the shoe was edited successfully, otherwise false.\r\n     */\r\n    public edit_shoe(model: any, shoeId: any, size: any, cp: any, rp: any, brand: any, colorway: any) {\r\n        const result = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").updateOne({shoe_id: shoeId},\r\n                    {$set: {brand, colorway, current_price: cp, model, retail_price: rp, size}});\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Editing a shoe has failed\");\r\n                return false;\r\n            });\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Removes a shoe from the database.\r\n     *\r\n     * @class ProductModel\r\n     * @method remove_shoe\r\n     * @param shoeId {Any} the shoe_id of the new shoe.\r\n     * @return true if the shoe was added successfully, otherwise false.\r\n     */\r\n    public remove_shoe(shoeId: any) {\r\n        const removeShoe = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").deleteOne( {shoe_id: shoeId});\r\n                db!.collection(\"user_shoes\").deleteMany({ shoe_id: shoeId});\r\n                db!.collection(\"notifications\").deleteMany({ shoe_id: shoeId});\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Removing a shoe has failed\");\r\n                return false;\r\n            });\r\n        return removeShoe;\r\n    }\r\n\r\n}\r\n"]}